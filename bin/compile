set -e

# debug
# set -x

# parse and derive params
indent() {
  sed -u 's/^/-----> /'
}


BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

mkdir -p /app/tdlib

mkdir -p $BUILD_DIR/tdlib

cd $BUILD_DIR/tdlib
git clone https://github.com/tdlib/td.git $BUILD_DIR/tdlib

rm -rf build
mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX:PATH=../tdlib ..
cmake --build . --target install  -DCMAKE_INSTALL_PREFIX:PATH=/app/tdlib

cd /
ls -R /app